{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="author" content="Felraine Cataos" />
    <meta name="Dashboard" content="Dashboard Screen" />

    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'dashboard_app/dashboardStyles.css' %}"
    />

    <title>Dashboard</title>
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      rel="icon"
      type="image/x-icon"
      href="{% static 'images/CIT_logo.png' %}"
    />
  </head>
  <body>
    <div class="sidebar">
      <div class="top">
        <div class="logo">
          <img
            src="{% static 'images/CIT_logo.png' %}"
            alt="logo"
            class="logo"
          />
          <span class="orgName">CSS</span>
        </div>
        <i class="bx bx-menu" id="btn"></i>
        <div class="user">
          <img
            src="{% static 'images/profile.jpg' %}"
            alt="user"
            class="user"
          />
          <div class="name">
            <p class="username">{{ fname }} {{ lname }}</p>
            <p class="role">
              {% if user_role == 0 %} Member {% else %} {% if user_role == 1 %}
              Admin {% else %} Unknown Role {% endif %} {% endif %}
            </p>
          </div>
        </div>
        <ul>
          <li>
            <a href="{% url 'dashboard' %}">
              <img
                src="{% static 'images/home.png' %}"
                alt="home"
                class="icon home-icon"
              />
              <span class="nav-item">Dashboard</span>
            </a>
            <span class="tooltip">Dashboard</span>
          </li>
          <li>
            <a href="{% url 'calendar' %}">
              <img
                src="{% static 'images/calendar.png' %}"
                alt="calendar"
                class="icon calendar-icon"
              />
              <span class="nav-item">Calendar</span>
            </a>
            <span class="tooltip">Calendar</span>
          </li>
          <li>
            <a href="{% url 'members' %}">
              <img
                src="{% static 'images/group.png' %}"
                alt="Members List"
                class="icon member-icon"
              />
              <span class="nav-item">Members</span>
            </a>
            <span class="tooltip">Members</span>
          </li>
          <li>
            <a href="{% url 'register' %}">
              <img
                src="{% static 'images/logout.png' %}"
                alt="logout"
                class="icon logout-icon"
              />
              <span class="nav-item">Logout</span>
            </a>
            <span class="tooltip">Logout</span>
          </li>
        </ul>
      </div>
    </div>

    <!-- Start adding code here for UI-->
<div class="main-content">
  <div class="container">
    <h1>Dashboard</h1>
  </div>
  <div id="dashboard"></div>
  <div class="events">
    <div class="eventHeader">
      <h2>Upcoming Events</h2>
      <button class="addEventBtn" id="addEventBtn">+ Add Event</button>
    </div>
    <div class="eventListContainer">

      {% for event in events %}      <!--event list-->
      <div class="eventList">
        <h3>{{ event.title }}</h3>
        <p>{{ event.description }}</p>
        <p><strong>Location:</strong> {{ event.location }}</p>
        <p><strong>Date & Time:</strong> {{ event.dateTime }}</p>

        <form method="POST" action="{% url 'deleteEvent' event.id %}" onsubmit="return confirmDel();"> <!--delete event-->
          {% csrf_token %}
          <button type="submit" class="deleteBtn">Delete</button>
        </form>
        <!--edit event-->
        <button class="editBtn" onclick="openEditForm(
        '{{ event.id }}',   
        '{{ event.title }}',
        '{{ event.description }}',
        '{{ event.location }}', 
        '{{ event.dateTime }}')"
        >Edit</button>
      </div>
      {% empty %}
      <p>No upcoming events.</p>
      {% endfor %}
    </div>
  </div>
</div>

<div class="overlay" id="overlay"></div>
<div class="eventFormContainer" id="eventFormContainer">
  <span class="closeBtn" onclick="closeForm()">&times;</span>

  <h2 class="title" id="formTitle">Add New Event</h2>
  <form class="eventForm" id="eventForm" method="post" action="{% url 'addEvents' %}">
    {% csrf_token %}
    <input type="hidden" id="edit_event_id" name="event_id">
    <label for="title">Title:</label>
    <input type="text" id="title" name="title" required>
    <br><br>
    <label for="description">Description:</label>
    <textarea id="description" name="description" required></textarea>
    <br><br>
    <label for="location">Location:</label>
    <input type="text" id="location" name="location" required>
    <br><br>
    <label for="date_time">Date & Time:</label>
    <input type="datetime-local" id="date_time" name="date_time" required>
    <br><br>
    <button class="saveEventBtn" type="submit" id="saveEventBtn">Save Event</button>
  </form>
      
    </div>
  </div>

  <script>
    // confirm
    function confirmDel() {
        const c = confirm("Are you sure you want to delete this event?");
        if (c) {
            alert("Event Deleted Successfully!");
            return true;
        } else {
            return false;
        }
    }

    // edit event form
  function openEditForm(id, title, description, location, dateTime) {
      document.getElementById('edit_event_id').value = id;
      document.getElementById('title').value = title;
      document.getElementById('description').value = description;
      document.getElementById('location').value = location;
      document.getElementById('date_time').value = dateTime;

      // Change the form title and action URL
      document.getElementById('formTitle').innerText = "Edit Event";
      document.getElementById('eventForm').action = "{% url 'updateEvent' %}"; 

      document.getElementById('eventFormContainer').style.display = "block";
      document.getElementById('overlay').style.display = "block";
  }

  // Open add event form
  const addEventBtn = document.getElementById('addEventBtn');
  addEventBtn.onclick = function() {
      document.getElementById('formTitle').innerText = "Add New Event";
      document.getElementById('eventForm').action = "{% url 'addEvents' %}";
      document.getElementById('eventForm').reset(); 
      document.getElementById('eventFormContainer').style.display = "block";
      document.getElementById('overlay').style.display = "block";
  }

  // Close form
  function closeForm() {
      document.getElementById('eventFormContainer').style.display = "none";
      document.getElementById('overlay').style.display = "none";
  }

  
  document.getElementById('overlay').onclick = function() {
      closeForm();
  }
    </script>

    <script>
      let btn = document.querySelector("#btn");
      let sidebar = document.querySelector(".sidebar");

      btn.onclick = function () {
        sidebar.classList.toggle("active");
      };

      const listItems = document.querySelectorAll("li");
      listItems.forEach((listItem) => {
        listItem.addEventListener("mouseover", function () {
          const homeIcon = this.querySelector(".home-icon");
          const calendarIcon = this.querySelector(".calendar-icon");
          const memberIcon = this.querySelector(".member-icon");
          const settingsIcon = this.querySelector(".settings-icon");
          const logoutIcon = this.querySelector(".logout-icon");

          if (homeIcon) {
            homeIcon.src = "{% static 'images/home2.png' %}";
          }
          if (calendarIcon) {
            calendarIcon.src = "{% static 'images/calendar2.png' %}";
          }
          if (memberIcon) {
            memberIcon.src = "{% static 'images/group2.png' %}";
          }
          if (settingsIcon) {
            settingsIcon.src = "{% static 'images/settings2.png' %}";
          }
          if (logoutIcon) {
            logoutIcon.src = "{% static 'images/logout2.png' %}";
          }
        });

        listItem.addEventListener("mouseout", function () {
          const homeIcon = this.querySelector(".home-icon");
          const calendarIcon = this.querySelector(".calendar-icon");
          const memberIcon = this.querySelector(".member-icon");
          const settingsIcon = this.querySelector(".settings-icon");
          const logoutIcon = this.querySelector(".logout-icon");

          if (homeIcon) {
            homeIcon.src = "{% static 'images/home.png' %}";
          }
          if (calendarIcon) {
            calendarIcon.src = "{% static 'images/calendar.png' %}";
          }
          if (memberIcon) {
            memberIcon.src = "{% static 'images/group.png' %}";
          }
          if (settingsIcon) {
            settingsIcon.src = "{% static 'images/settings.png' %}";
          }
          if (logoutIcon) {
            logoutIcon.src = "{% static 'images/logout.png' %}";
          }
        });
      });
    </script>
  </body>
</html>
